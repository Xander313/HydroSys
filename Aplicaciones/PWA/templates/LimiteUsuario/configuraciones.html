{% extends 'layouts/base.html' %}
{% load static %}

{% block title %}Mis sensores{% endblock %}
{% block seccion %}Configuraciones{% endblock %}

{% block content %}

<a href="#" onclick="document.getElementById('modal').style.display='block'">➕ Agregar nuevo sensor</a>

<form method="POST">
    {% csrf_token %}
    
    <label for="sensor">Mis Sensores:</label>
    <select name="sensor_id" id="sensor" required>
        {% for sensor in sensores %}
            <option value="{{ sensor.id }}">{{ sensor.sensor.nombreSensor }} - {{ sensor.ubicacionSensor }}</option>
        {% endfor %}
    </select><br><br>

    <label for="limite">Medición base:</label>
    <input type="number" step="0.01" name="limiteDiario" id="limite" required><br><br>

    <label for="limite">Límite Diario (Litros):</label>
    <input type="number" step="0.01" name="limiteDiario" id="limite" required><br><br>

    <label for="umbral">Límite máximo de consumo (%):</label>
    <input type="number" step="0.01" name="umbralAlerta" id="umbral" required><br><br>

    <label for="tiempo">Tiempo de genración de alertas:</label>
    <input type="number" step="0.01" name="tiempo" id="tiempo" required><br><br>

    <button type="submit">Guardar</button>
</form>

<h3>Historial de límites configurados:</h3>
<ul>
    {% for limite in limites %}
        <li>{{ limite.usuarioSensor.sensor.nombreSensor }} - {{  limite.usuarioSensor.sensor.ubicacionSensor }}: {{ limite.limiteDiario }} L - Umbral {{ limite.umbralAlerta }}% ({{ limite.fechaCambio }})</li>
    {% empty %}
        <li>No hay configuraciones aún.</li>
    {% endfor %}
</ul>








<div id="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#00000099;">
    <div style="background:white; margin:10% auto; padding:20px; width:400px; border-radius:10px; position:relative;">
        <h3>Asignar nuevo sensor</h3>
        <form method="POST">
            {% csrf_token %}
            <label for="sensor">Identificador único del sensor:</label>
            <input type="text" name="sensor_id" required>
            <label for="ubicacion">Ubicación donde estará el sensor:</label>
            <input type="text" name="ubicacion" required>
            <button type="submit">Guardar</button>
            <button type="button" onclick="document.getElementById('modal').style.display='none'">Cancelar</button>
        </form>
    </div>
</div>





{% endblock %}
